language: go
go:
  - 1.7.x
  - 1.8.x
  - tip

matrix:
  allow_failures:
    - go: tip

# `make ci` uses Docker.
sudo: required
services:
  - docker

env:
  global:
    - BUILDTAGS="seccomp apparmor selinux ambient"

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y libseccomp-dev libapparmor-dev
  - env | grep TRAVIS_

script:
  - cd ../.. && TARGET=$(ls -d */runc); mkdir opencontainers && cd opencontainers && ln -s ../${TARGET} runc && cd runc || true
  - make BUILDTAGS="${BUILDTAGS}"
  - make BUILDTAGS="${BUILDTAGS}" clean validate test
